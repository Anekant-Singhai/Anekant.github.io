<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mywebserver</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mywebserver</h1><br/><p></p><p></p><p>now look at the nostromo one , I found a direct exploit rce for this one : </p><p>the code is in the “exploit” section and is explaied when copied to a file via comments , so do look and read that</p><p></p><p>also after the exploit , we could only run one single command , so how to get the shell?</p><p>we can do this via starting the python server and wget the nc binary from our filesystem to the webserver into the tmp directory or another writable directory , so that the reverse shell may be possible :</p><p></p><p></p><p>first find the writable files via :</p><p>[#] find &lt;location&gt; -writable </p><p>[#] # find / -perm -755 -not -perm -1000 -exec ls -ldb {} ;</p><p></p><p><img src="images/6-1.png" alt="images/6-1.png" /></p><p></p><p>some of them are: tmp , dev/shm , var/tmp , usr/local/</p><p></p><p>then we run our own server: <h3>python -m SimpleHTTPServer 8000</h3></p><p></p><p><span style="color:#865e3c;background-color:#ebd2a8;">python3 -m http.server 8000</span></p><p></p><p>then we place our own nc binary over the server by executing the command from that folder:</p><p><img src="images/6-2.png" alt="images/6-2.png" /></p><p></p><p>then we wget the command , PS: before that do uname -a for architecture</p><p></p><p>wget the folder:</p><p><img src="images/6-3.png" alt="images/6-3.png" /></p><p>then check the file size too</p><p>give the file perms 777 </p><p></p><p>then start the listening on attacker&#39;s machine : nc -nlvp &lt;port&gt; </p><p>PS: while using port use top 10 ports so that firewall might allow it</p><p>for top ports:</p><p><img src="images/6-4.png" alt="images/6-4.png" /></p><p><img src="images/6-5.png" alt="images/6-5.png" /></p><p>execute the shell:</p><p><img src="images/6-6.png" alt="images/6-6.png" /></p><p></p><p>now this shell looks bland , not a normal looking linux shell:</p><p><img src="images/6-7.png" alt="images/6-7.png" /></p><p>we can do this , first we look how man shells are there in the machine</p><p></p><p><img src="images/6-8.png" alt="images/6-8.png" /></p><p></p><p>to check for current shell: echo $NOLOGIN</p><p></p><p></p><p>ctrl+z for bg process change</p><p><img src="images/6-9.png" alt="images/6-9.png" /></p><p></p><p>then do fg</p><p>then do ctrl+d</p><p></p><p>can find everything here:</p><p><a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a></p><p><div class="codebox"><pre>1. Python to spawn a PTY<br /><br />$ python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;<br />        or<br />$ python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;<br />2. Put the shell in to background with Ctrl-Z<br /><br />$ Ctrl-Z<br />3. Examine the current terminal and STTY info and match it<br /><br /># echo $TERM<br /># stty -a<br />The information needed is the TERM type (“xterm-256color”) and the size of the current TTY (“rows 37; columns 146”)<br /><br />4. Set the current STTY to type raw and tell it to echo the input characters<br /><br /> # stty raw -echo<br />5. Foreground the shell with fg and re-open the shell with reset<br /><br /># fg<br />   reset<br />6. stty size to match our current window<br /><br />$ export SHELL=bash<br />$ export TERM=xterm256-color<br />$ stty rows 37 columns 146<br />$ bash -i<br />7. Set PATH TERM and SHELL if missing<br /><br />$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br />$ export TERM=xterm<br />$ export SHELL=bash<br />$ cat /etc/profile; cat /etc/bashrc; cat ~/.bash_profile; cat ~/.bashrc; cat ~/.bash_logout; env; set<br />$ export PS1=&#39;[\u@\h \W]\$ &#39;<br /></pre></div></p><p></p><p>sometimes it gets stuck , so look out , cancel and do again</p></div>
</body>
</html>
