#latex-injection #os-command-injection #priv-esc
## Recon
nmap result

### Basic Site Enum:
![[Pasted image 20230716200350.png]]

![[Pasted image 20230716200131.png]]
all the links in 2 are static leading to home page
3 leads to a new page:
![[Pasted image 20230716200418.png]]
There are some examples here , looks like we can generate the formulas with this tool whatever is running behind , also to look for it's a php file for the eqn: \frac{123}{234}
like 
![[Pasted image 20230716200536.png]]
can we give command here: ![[Pasted image 20230716200609.png]]
nope not working
This is some kind of software like working 
This software must be somewhere on internet , so it must have some vulnerability too , I always first search the exact software vuln on google and I landed on this blog:
```
https://infosecwriteups.com/latex-to-rce-private-bug-bounty-program-6a0b5b33d26a
```
Whenever you see a user input in a vulnerable machine , there is a high chance that it is vulnerable
So we know this for sure that whatever may be the scenario , this endpoint is vulnerable , we just need to make sure that we provide the right payload , after going through the article above , it said 3 articles we get some basic payloads , whenever I try them I get:

![[Pasted image 20230716234253.png]]
Then I landed on this blog:
Reference
https://faculty.math.illinois.edu/~hildebr/tex/course/intro2.html

![[Pasted image 20230716234136.png]]
so we need to lace our payloads with this that makes our string start and end and this `Payloadsallthethings` also mentions it:
![[Pasted image 20230717000736.png]]

reference:`https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection`

I tried many payloads here :
![[Pasted image 20230716235249.png]]
and this one worked:
```
$\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}$
```
I altered the text to /etc/passwd
![[Pasted image 20230716235217.png]]
![[Pasted image 20230717010747.png]]
.htpasswd file is a file that contains the password of the user 
Reading the file .htpasswd for user password:
`$\lstinputlisting{/var/www/dev/.htpasswd}$`
how did we get this /dev/?:
![[Pasted image 20230718134309.png]]
do the dns enum
![[Pasted image 20230717005127.png]]

This is the hash generated by the htpasswd command when googling the first strings of the hash `$apr1$` it's apache hash and that too md5 so when we try to search in hashcat:
hashcat -h | grep -i "md5" | grep -i "apache"
gives the hash number
command:
```
hashcat -m 1600 -a 0 <passwrd> <wrdlst>
```

![[Pasted image 20230717010612.png]]
`calculus20`
![[Pasted image 20230717011001.png]]

# Priv-esc:
Always remember to have an image of a freshly instaled linux and whatever might not align in the image that you are doing , probably is there for a reason of priv-esc
like here:
![[Pasted image 20230718125557.png]]
while searching for the writable directory , why the opt has one?
wierd huh?
![[Pasted image 20230718130013.png]]
![[Pasted image 20230718130104.png]]
I wrote a bash script with the commands:
```
bash /bin/bash
```
Nope didn't work , so searched this exact term `gnuplot` in google
![[Pasted image 20230718131653.png]]
we had to place a file with gnuplt format:
```
https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/
```
The catch here was to look at the jobs , we just need to place the file here
![[Pasted image 20230718132744.png]]
It was automatically executing it , so put up a listener and wait
![[Pasted image 20230718132333.png]]

![[Pasted image 20230718132313.png]]
